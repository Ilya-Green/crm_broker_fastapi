{% extends "layout.html" %} {% block header %}
<div class="d-flex justify-content-between align-items-center">
  <h1>{{ model.label }}</h1>
  <ol class="breadcrumb">
    <li class="breadcrumb-item">
      <a href="{{ url_for(__name__ ~ ':index')}}">{{_("Admin")}}</a>
    </li>
    <li class="breadcrumb-item active">{{ model.label }}</li>
  </ol>
</div>
{% endblock %} {% block modal %} {% include "modals/loading.html" %} {% include
"modals/error.html" %} {% include "modals/actions.html" %} {% endblock %} {%
block content %}
<div class="container-fluid">
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header">
          <div id="btn_container" class="card-title"></div>
          <div class="card-actions">
            <div class="btn-list">
              <div class="dropdown" id="actions-dropdown" style="display: none">
                <button
                  type="button"
                  class="btn dropdown-toggle"
                  data-bs-toggle="dropdown"
                  id="actionDropdownButton"
                >
                  {{_("With selected")}} (<span class="actions-selected-counter">0</span
                  >)
                </button>
                <div
                  class="dropdown-menu"
                  aria-labelledby="actionDropdownButton"
                >
                  {% for action in _actions %}
                  <!-- prettier-ignore -->
                  <a
                    class="dropdown-item action-item"
                    type="button"
                    href="#"
                    id="{{action.id}}"
                    {% if action.confirmation %}
                    data-bs-toggle="modal"
                    data-bs-target="#modal-action"
                    data-confirmation="{{action.confirmation}}"
                    {% else %}
                    data-no-confirmation-action="true"
                    {%endif%}
                    data-form="{{action.form}}"
                    data-name="{{action.name}}"
                    data-submit-btn-text="{{action.submit_btn_text}}"
                    data-submit-btn-class="{{action.submit_btn_class}}"
                  >
                    {{ action.text }}
                  </a>
                  {% endfor %}
                </div>

                <div class="modal modal-blur fade" id="modal-action-status" tabindex="-1" role="dialog" aria-hidden="true">
                  <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
                      <div class="modal-content">
                          <div class="modal-body">
                              <div id="actionConfirmation"></div></br>
                              <div id="modal-form"></div>
                              <select class="form-select" name="id" id="status-select">
                      </select>
                          </div>
                          <div class="modal-footer">
                              <button type="button" class="btn btn-link link-secondary me-auto"
                                      data-bs-dismiss="modal">{{ _("Cancel") }}</button>
                              <button id="actionSubmit" type="button" class="btn btn-primary"
                                      data-bs-dismiss="modal">{{ _("Yes, Proceed") }}</button>
                          </div>
                      </div>
                  </div>
              </div>
                  <script>
                      fetch('/api/v1/client/statuses')
                          .then(response => response.json())
                          .then(data => {
                            const selectElement = document.getElementById('status-select');
                            data.forEach(status => {
                              const optionElement = document.createElement('option');
                              optionElement.value = status.id;
                              optionElement.textContent = status.name.toUpperCase();
                              selectElement.appendChild(optionElement);
                              console.log("88 str");
                            });
                          })
                          .catch(error => {
                            console.error('Error:', error);
                          });
                  </script>
                  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
<!--                  <script>-->






<!--                          // WORKING CODE-->
<!--                            function submitAction(name, formData) {-->
<!--                                $("#modal-loading").modal("show");-->
<!--                                query = new URLSearchParams();-->
<!--                                selectedRows = table.rows({ selected: true }).ids().toArray();-->
<!--                                 selectedRows.forEach((s) => {-->
<!--                                  query.append("pks", s);-->
<!--                                });-->
<!--                                query.append("name", name);-->

<!--                                $('#modal-action :input').each(function() {-->
<!--                                    query.append(this.name, $(this).val());-->
<!--                                });-->

<!--                                    const url = window.location.origin + "/admin/api/client/action?" + query.toString();-->
<!--                                    fetch(url, {-->
<!--                                        method: "POST",-->
<!--                                        body: formData,-->
<!--                                    })-->
<!--                                  .then(async (response) => {-->
<!--                                      location.reload();-->
<!--                                    await new Promise((r) => setTimeout(r, 500));-->
<!--                                    $("#modal-loading").modal("hide");-->
<!--                                    if (response.ok) {-->
<!--                                      table.rows().deselect();-->
<!--                                      table.ajax.reload();-->
<!--                                      successAlert((await response.json())["msg"]);-->
<!--                                    } else {-->
<!--                                      if (response.status == 400) {-->
<!--                                        return Promise.reject((await response.json())["msg"]);-->
<!--                                      }-->
<!--                                      return Promise.reject("Something went wrong!");-->
<!--                                    }-->
<!--                                  })-->
<!--                                  .catch(async (error) => {-->
<!--                                    await new Promise((r) => setTimeout(r, 500));-->
<!--                                    dangerAlert(error);-->
<!--                                  });-->
<!--                              }-->
<!--                            console.log("142");-->

<!--                          $("#modal-action-status").on("show.bs.modal", function (event) {-->
<!--                              console.log('test');-->
<!--                              var button = $(event.relatedTarget); // Button that triggered the modal-->
<!--                              var confirmation = button.data("confirmation");-->
<!--                              var form = button.data("form");-->
<!--                              var name = button.data("name");-->
<!--                              var submit_btn_text = button.data("submit-btn-text");-->
<!--                              var submit_btn_class = button.data("submit-btn-class");-->

<!--                              var modal = $(this);-->
<!--                              modal.find("#actionConfirmation").text(confirmation);-->
<!--                              var modalForm = modal.find("#modal-form");-->
<!--                              $('#modal-form').html(form);-->
<!--                              var actionSubmit = modal.find("#actionSubmit");-->
<!--                              actionSubmit.text(submit_btn_text);-->
<!--                              actionSubmit.removeClass().addClass(`btn ${submit_btn_class}`);-->
<!--                              actionSubmit.unbind();-->
<!--                              actionSubmit.on("click", function (event) {-->
<!--                                  const formElement = modalForm.find("form");-->
<!--                                  const formData = formElement.length-->
<!--                                      ? new FormData(formElement.get(0))-->
<!--                                      : new FormData();-->
<!--                                  submitAction(name, formData);-->
<!--                              });-->
<!--                          });-->



<!--                          //END WORKING CODE-->

<!--                  </script>-->
<!--                    <script>-->
<!--                        function pushupdate(){-->
<!--                            console.log("HUETA")-->
<!--                        }-->
<!--                        function update(){-->
<!--                                                   // Получаем элемент с заданным id-->
<!--                        var elementsstatus = document.getElementById('modal-action-status');-->
<!--                       console.log(elementsstatus, "FOUNDED");-->
<!--                        // Проверяем, есть ли такой элемент и его значение свойства display-->
<!--                        if (elementsstatus) {-->
<!--                          var displayValue = window.getComputedStyle(elementsstatus).getPropertyValue('display');-->

<!--                          // Проверяем значение свойства display-->
<!--                          if (displayValue === 'block') {-->
<!--                            console.log('Свойство display у элемента с id "modal-action-status" равно "block"');-->
<!--                          }-->
<!--                          if (displayValue === 'none') {-->
<!--                            console.log('Свойство display у элемента с id "modal-action-status" равно "none"');-->
<!--                          }-->
<!--                        }-->
<!--                        }-->


<!--                    </script>-->
              </div>
              {%if model.can_create(request)%}
              <a
                href="{{ url_for(__name__ ~ ':create', identity=model.identity)}}"
                class="btn btn-primary btn-block ms-2"
              >
                <i class="fa-solid fa-plus me-2"></i>
                 {{ _("New %(name)s", name=model.name ) }}
              </a>
              {% endif %}
            </div>
          </div>
        </div>
        <div class="card-body border-bottom p-0">
          <div class="d-flex m-3">
            <div id="pageLength_container">
                  <input type="text" id="statusInput" class="form-control" placeholder="id" style="width: 40px; display: inline-block;">
                  <button class="btn btn-light" onclick="statusFunc()">Status</button>
                  <script>
                  function statusFunc() {
                    // Получаем текущий URL-адрес
                    var url = new URL(window.location.href);
                     // Получаем значение из поля ввода
                    var id = document.getElementById('statusInput').value;
                    // Добавляем параметры
                    url.searchParams.set('status_id', id);
                    // Перенаправляем на обновленный URL-адрес
                    window.location.href = url.toString();
                  }
                  </script>
                  <input type="text" id="responsibleInput" class="form-control" placeholder="id" style="width: 40px; display: inline-block;">
                  <button class="btn btn-light" onclick="responsibleFunc()">Responsible</button>
                  <script>
                  function responsibleFunc() {
                    // Получаем текущий URL-адрес
                    var url = new URL(window.location.href);
                     // Получаем значение из поля ввода
                    var id = document.getElementById('responsibleInput').value;
                    // Добавляем параметры
                    url.searchParams.set('responsible_id', id);
                    // Перенаправляем на обновленный URL-адрес
                    window.location.href = url.toString();
                  }
                  </script>
                  <button id="showButton" class="btn btn-light" onclick="showFunc()">Show All</button>
                  <button id="hideButton" class="btn btn-light" onclick="hideFunc()">Hide</button>
                  <script>
                  function showFunc() {
                    // Получаем текущий URL-адрес
                    var url = new URL(window.location.href);
                    // Добавляем параметры
                    url.searchParams.set('hide', 'false');
                    // Перенаправляем на обновленный URL-адрес
                    window.location.href = url.toString();
                  }
                  function hideFunc() {
                    // Получаем текущий URL-адрес
                    var url = new URL(window.location.href);
                    // Добавляем параметры
                    url.searchParams.delete('hide');
                    // Перенаправляем на обновленный URL-адрес
                    window.location.href = url.toString();
                  }
                  </script>
                  <script>
                    var urlParams = new URLSearchParams(window.location.search);

                    if (urlParams.get('hide') === 'false') {
                        document.getElementById('hideButton').style.display = 'inline-block';
                        document.getElementById('showButton').style.display = 'none';
                    } else {
                        document.getElementById('hideButton').style.display = 'none';
                        document.getElementById('showButton').style.display = 'inline-block';
                    }
                  </script>
                  <button class="btn btn-light" onclick="clearFunc()">Clear filters</button>
                  <script>
                  function clearFunc() {
                    // Получаем текущий URL-адрес
                    var url = new URL(window.location.href);
                    url.searchParams.forEach(function(value, paramName) {
                        url.searchParams.delete(paramName);
                    });
                    // Перенаправляем на обновленный URL-адрес
                    window.location.href = url.toString();
                  }
                  </script>
              </div>
            <div class="ms-auto text-muted">
              <div class="ms-2 d-inline-block">
                <div class="input-icon">
                  <span class="input-icon-addon">
                    <!-- Download SVG icon from http://tabler-icons.io/i/search -->
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="icon"
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                      stroke="currentColor"
                      fill="none"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
                      <circle cx="10" cy="10" r="7" />
                      <line x1="21" y1="21" x2="15" y2="15" />
                    </svg>
                  </span>
                  <input
                    type="search"
                    id="searchInput"
                    value=""
                    class="form-control"
                    placeholder="{{_('Search')}}..."
                    aria-label="Search in list"
                  />
                </div>
              </div>
            </div>
          </div>
          <div id="alertContainer"></div>
        </div>
        <table id="dt" class="table table-vcenter text-nowrap">
          <thead>
            <tr id="table-header">
              <th></th>
              <th></th>
            </tr>
          </thead>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block head_css %}
<link
  rel="stylesheet"
  href="{{ url_for(__name__ ~ ':statics', path='css/dt.min.css') }}"
/>
<link
  rel="stylesheet"
  href="{{ url_for(__name__ ~ ':statics', path='css/dt.checkboxes.css') }}"
/>
{%for link in model._additional_css_links(request, "LIST" | ra)%}
<link rel="stylesheet" href="{{ link }}">
{%endfor%}
<style>
  div.dataTables_wrapper div.dataTables_info {
    padding-top: 0;
  }
  table.dataTable span.highlight {
    background-color: #ffff88;
    border-radius: 0.28571429rem;
  }

  table.dataTable span.column_highlight {
    background-color: #ffcc99;
    border-radius: 0.28571429rem;
  }
  table.dataTable.dtr-inline.collapsed > tbody > tr > td.dtr-control:before,
  table.dataTable.dtr-inline.collapsed > tbody > tr > th.dtr-control:before {
    background-color: #206bc4;
  }
  table.dataTable {
    margin-top: 0px !important;
    margin-bottom: 0px !important;
  }
</style>
{% endblock %} {% block script %}
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/vendor/moment.min.js') }}"
></script>
{% if get_locale() != 'en' %}
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='i18n/momentjs/' ~ get_locale() ~ '.js') }}"
></script>
{% endif %}
{% if 'pdf' in model.export_types%}
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/vendor/pdfmake.min.js') }}"
></script>
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/vendor/vfs_fonts.js') }}"
></script>
{% endif %}
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/vendor/dt.min.js') }}"
></script>
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/vendor/dt.checkboxes.js') }}"
></script>
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/vendor/dt.searchHighlight.js') }}"
></script>
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/utils.js') }}"
></script>
<script>
  var model = {{__js_model__ | tojson | safe}};
</script>
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/render.js') }}"
></script>
{% if custom_render_js(request) %}
<script type="text/javascript" src="{{ custom_render_js(request) }}"></script>
{% endif %}
{%for link in model._additional_js_links(request, "LIST" | ra)%}
<script type="text/javascript" src="{{ link}}"></script>
{%endfor%}
<script
  type="text/javascript"
  src="{{ url_for(__name__ ~ ':statics', path='js/list.js') }}"
></script>
{% endblock %}

